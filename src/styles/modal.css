/* Modal */
.modal { display: none; position: fixed; z-index: 9999; inset: 0; background: linear-gradient(180deg, rgba(0,0,0,0.5), rgba(0,0,0,0.65)); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); animation: fadeIn var(--transition-base); touch-action: none; }
.modal.show { display: flex; align-items: center; justify-content: center; }
.modal-content {
  background: var(--glass-bg-strong); border-radius: 24px; padding: 1.75rem; max-width: 640px; width: 90%; max-height: 90vh; overflow-y: auto; border: 1px solid var(--glass-stroke-strong); box-shadow: var(--shadow-lg); animation: slideUpBounce 0.5s ease; backdrop-filter: blur(var(--glass-blur)); -webkit-backdrop-filter: blur(var(--glass-blur));
}
/* Light theme: use a gentle light overlay and solid content to avoid muddy colors */
[data-theme="light"] .modal { background: linear-gradient(180deg, rgba(255,255,255,0.55), rgba(255,255,255,0.7)); }
[data-theme="light"] .modal-content { background: #ffffff; border: 1px solid rgba(0,0,0,0.08); }
[data-theme="light"] .modal-content canvas { background: #ffffff; }
@keyframes slideUpBounce {
  0% { opacity: 0; transform: translateY(30px) scale(0.9); }
  80% { transform: translateY(-5px) scale(1.01); }
  100% { opacity: 1; transform: translateY(0) scale(1); }
}
.modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.25rem; padding-bottom: 1rem; border-bottom: 1px solid var(--glass-stroke); }
.modal-title {
  font-size: 1.5rem; font-weight: 800; background: var(--gradient-1); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
}
.close-btn {
  width: 36px; height: 36px; border-radius: 10px; background: var(--glass-bg); border: 1px solid var(--glass-stroke); color: var(--text-secondary);
  cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all var(--transition-fast); font-size: 1.25rem;
}
.close-btn:hover { background: var(--danger); color: white; transform: rotate(90deg); }

.form-grid { display: grid; gap: 1.0rem; }
.form-row { display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem; }
.form-group { display: flex; flex-direction: column; }
.form-label {
  margin-bottom: 0.5rem; color: var(--text-secondary); font-size: 0.8125rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.03em;
}
.form-input, .form-textarea, .form-select {
  padding: 0.875rem; background: var(--glass-bg); border: 1px solid var(--glass-stroke); border-radius: 12px; color: var(--text-primary); font-size: 0.9rem; transition: all var(--transition-fast); width: 100%;
  min-height: 44px;
}
.form-input:focus, .form-textarea:focus, .form-select:focus { outline: none; border-color: var(--accent); box-shadow: var(--focus-ring); background: var(--glass-bg-strong); }
.form-textarea { resize: vertical; min-height: 120px; font-family: inherit; }

/* Prettier select styling */
.form-select {
  appearance: none; -webkit-appearance: none; -moz-appearance: none; position: relative;
  background-image: linear-gradient(180deg, transparent, transparent),
                    url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none"><path d="M6 8l4 4 4-4" stroke="%23bbb" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>');
  background-repeat: no-repeat, no-repeat;
  background-position: right 12px center, right 12px center;
  padding-right: 2.5rem;
}
.form-select:focus {
  border-color: var(--accent);
}

/* Small helper for the WIP modal */
.wip-input-row { display: grid; grid-template-columns: 1fr auto; gap: 0.5rem; align-items: center; }
.form-hint { color: var(--text-muted); font-size: 0.8rem; margin-top: 0.5rem; }

/* Custom select component */
.is-hidden-native { position: absolute !important; opacity: 0 !important; pointer-events: none !important; width: 0; height: 0; }
.cselect { position: relative; }
.cselect-btn {
  width: 100%; min-height: 44px; padding: 0.875rem 2.25rem 0.875rem 0.875rem;
  border-radius: 12px; border: 1px solid var(--glass-stroke);
  background: var(--glass-bg); color: var(--text-primary);
  display: flex; align-items: center; justify-content: space-between; gap: 0.5rem;
  transition: all var(--transition-fast);
}
.cselect-btn:focus { outline: none; box-shadow: var(--focus-ring); border-color: var(--accent); background: var(--glass-bg-strong); }
.cselect-chev { opacity: 0.8; }
.cselect-menu {
  position: absolute; left: 0; right: 0; top: calc(100% + 6px); z-index: 40;
  border-radius: 12px; border: 1px solid var(--glass-stroke);
  background: var(--glass-bg); backdrop-filter: blur(var(--glass-blur)); -webkit-backdrop-filter: blur(var(--glass-blur));
  box-shadow: var(--shadow-lg); display: none; max-height: 220px; overflow: auto;
}
.cselect.open-up .cselect-menu { top: auto; bottom: calc(100% + 6px); }
.cselect-menu .cselect-option:nth-child(-n+2) {
  position: sticky; top: 0; background: var(--glass-bg);
  z-index: 1; border-bottom: 1px solid var(--glass-stroke);
}
.cselect.open .cselect-menu { display: block; }
.cselect-option { padding: 0.6rem 0.8rem; cursor: pointer; }
@media (hover: hover) {
  .cselect-option:hover { background: var(--bg-hover); }
}
/* Unified selection/active visuals (mobile + desktop) */
.cselect-option.is-selected { background: color-mix(in oklab, var(--accent) 16%, transparent); }
.cselect-option.is-active { background: color-mix(in oklab, var(--accent) 28%, transparent); }

.form-actions { display: flex; gap: 0.75rem; justify-content: space-between; margin-top: 1.25rem; padding-top: 1.25rem; border-top: 1px solid var(--glass-stroke); }
.left-actions { display: flex; gap: 0.5rem; }
.right-actions { display: flex; gap: 0.5rem; }

/* Auth: segmented switch */
.segmented { display: inline-flex; align-self: start; border: 1px solid var(--glass-stroke); border-radius: 999px; background: var(--glass-bg); padding: 2px; gap: 2px; }
.seg-btn { padding: 0.4rem 0.9rem; border-radius: 999px; border: 0; background: transparent; color: var(--text-secondary); font-weight: 700; cursor: pointer; transition: all var(--transition-fast); }
.seg-btn:hover { color: var(--text-primary); }
.seg-btn.active { background: var(--bg-card); color: var(--text-primary); box-shadow: var(--shadow-sm); }
  .segmented { display: inline-flex; gap: 0.25rem; background: var(--glass-bg); border: 1px solid var(--glass-stroke); border-radius: 999px; padding: 0.25rem; }
  .seg-btn { background: transparent; border: none; padding: 0.4rem 0.75rem; border-radius: 999px; cursor: pointer; color: var(--text-secondary); }
  .seg-btn.active, .seg-btn:hover { background: var(--bg-hover); color: var(--text-primary); }

/* Inputs with icons/affixes */
.input-with-icon { position: relative; display: grid; grid-template-columns: 2rem 1fr auto; align-items: center; }
.input-with-icon .form-input { padding-left: 0.25rem; border-top-left-radius: 0; border-bottom-left-radius: 0; }
.input-with-icon .input-icon { width: 2rem; display: inline-flex; align-items: center; justify-content: center; color: var(--text-muted); background: var(--glass-bg); height: 44px; border: 1px solid var(--glass-stroke); border-right: none; border-top-left-radius: 12px; border-bottom-left-radius: 12px; }
.input-with-icon .input-affix { width: 44px; height: 44px; border-radius: 12px; border: 1px solid var(--glass-stroke); margin-left: 0.5rem; background: var(--glass-bg); color: var(--text-primary); cursor: pointer; display: inline-flex; align-items: center; justify-content: center; transition: all var(--transition-fast); }
.input-with-icon .input-affix:hover { background: var(--glass-bg-strong); }
.form-error { color: var(--danger); background: rgba(239, 68, 68, 0.08); border: 1px solid rgba(239, 68, 68, 0.35); border-radius: 12px; padding: 0.75rem; font-size: 0.9rem; }

/* Emoji presets picker */
.emoji-picker { position: relative; }
.emoji-input-row { display: grid; grid-template-columns: 1fr auto; gap: 0.5rem; align-items: center; }
.emoji-trigger {
  width: 44px; height: 44px; border-radius: 12px; border: 1px solid var(--glass-stroke);
  background: var(--glass-bg); color: var(--text-primary); cursor: pointer; display: inline-flex; align-items: center; justify-content: center;
  transition: all var(--transition-fast);
}
.emoji-trigger:hover { background: var(--glass-bg-strong); }
.emoji-popover {
  position: absolute; top: calc(100% + 6px); right: 0; z-index: 40; display: none;
  min-width: 260px; padding: 0.5rem; border-radius: 12px; border: 1px solid var(--glass-stroke);
  background: var(--glass-bg); backdrop-filter: blur(var(--glass-blur)); -webkit-backdrop-filter: blur(var(--glass-blur));
  box-shadow: var(--shadow-lg);
}
.emoji-picker.open .emoji-popover { display: block; animation: fadeIn var(--transition-base); }
.emoji-presets {
  display: grid; grid-template-columns: repeat(auto-fill, minmax(42px, 1fr)); gap: 0.35rem; margin-top: 0.5rem;
}
.emoji-preset {
  height: 40px; border-radius: 10px; border: 1px solid var(--glass-stroke); background: var(--glass-bg);
  display: inline-flex; align-items: center; justify-content: center; font-size: 1.1rem; cursor: pointer;
  transition: all var(--transition-fast);
}
.emoji-preset:hover { background: var(--glass-bg-strong); transform: translateY(-1px); }
.emoji-preset.is-selected {
  border-color: var(--accent); box-shadow: var(--focus-ring);
  background: linear-gradient(180deg, color-mix(in oklab, var(--accent) 14%, transparent), var(--glass-bg));
}
@media (prefers-reduced-motion: reduce) {
  .emoji-preset:hover { transform: none; }
}

/* Filter Modal */
.filter-groups { display: grid; gap: 1rem; }
.chips { display: flex; gap: 0.5rem; flex-wrap: wrap; }
.chip { padding: 0.4rem 0.7rem; border-radius: 999px; border: 1px solid var(--glass-stroke); background: var(--glass-bg); color: var(--text-primary); cursor: pointer; font-size: 0.85rem; backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); }
.chip.active { border-color: var(--accent); box-shadow: var(--focus-ring); }
.filter-footer { display: flex; justify-content: flex-end; gap: 0.5rem; margin-top: 1rem; }

/* Full-screen modal on small devices */
@media (max-width: 768px) {
  .modal.show { align-items: stretch; }
  .modal-content {
    width: 100%; height: 100%; max-width: none; max-height: none; border-radius: 0; border-left: none; border-right: none;
    padding-top: calc(1rem + var(--safe-top)); padding-bottom: calc(1rem + var(--safe-bottom));
  }
}
